name: integration-test-1

on:
    pull_request:
        branches:
            - master
    workflow_dispatch:

jobs:
    run-inference:
        runs-on: ubuntu-latest

        steps:

            - uses: actions/checkout@v4

            - name: upload test case
              uses: betanzos/scp-upload@v1.1.0
              with:
                host: ${{ secrets.TEST_VM }}
                username: ${{ secrets.TEST_VM_USERNAME }}
                key: ${{ secrets.SSH_PRIVATE_KEY }}
                source: './tests/agra/test_1.py'
                remote_dir: '/opt'
                recursive: 'false'

            - name: run test case
              uses: appleboy/ssh-action@v1.2.0
              with:
                host: ${{ secrets.TEST_VM }}
                username: ${{ secrets.TEST_VM_USERNAME }}
                key: ${{ secrets.SSH_PRIVATE_KEY }}
                script: |
                    python3 /opt/my.py
